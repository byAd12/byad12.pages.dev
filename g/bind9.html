<!--

Código por Adrián L. G. P.

~ Dedicatoria a: Ruth

-->

<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="keywords" content="Blog, BIND9, BIND, DNS, byAd12">
        <title>BIND9 - Linux; Windows DNS</title>
        
        <link rel="stylesheet" type="text/css" href="../recursos/blog.css">
    </head>
    <body>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <div class="menu_bar" id="menu_bar">
            <!-- BARRA DE MENÚ -->
            <h1 class="logo" translate="no"><a href="../index.html">by<span>Ad</span>12</a></h1>
            <ul>
                <li><a href="../guides.html">~/Guías</a></li>
                <li class="ocultarMOVIL"><a onclick="esconder()">./Ocultar</a></li>
                <li><input type="color" class="NavColorCambiar" id="NavColorCambiar2" onchange="CambiarNavColorCodigo2()"></li>
            </ul>
        </div>

        <div class="gtranslate_wrapper" id="gtranslate_wrapper"></div>
        <script>window.gtranslateSettings = {"default_language":"es","native_language_names":true,"detect_browser_language":true,"languages":["es","en","de","gl","ru"],"globe_color":"#66aaff","wrapper_selector":".gtranslate_wrapper","flag_size":16,"horizontal_position":"left","vertical_position":"top","globe_size":20}</script>
        <script src="https://cdn.gtranslate.net/widgets/latest/globe.js" defer></script>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark-dimmed.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js"></script>
        <script>hljs.highlightAll();</script>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <h1 style="margin: 15px 0;">BIND9</h1>
        <h2 class="TituloSecundario">Servidor DNS en Linux</h2>
        <h2 class="TituloCreditosSuperior">Adrián L. G. P.</h2>
        <hr>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <p style="color: black; position: sticky; top: 0;" id="dd"></p>
        <div class="parte1">
            <div>
                <h2>Instalación</h2>
                <pre class="codigo" translate="no"><code class="bash">apt-get update</code></pre>
                <pre class="codigo" translate="no"><code class="bash">apt-get install bind9</code></pre>
                <pre class="codigo" translate="no"><code class="bash">ufw allow 53</code></pre>
            </div>

            <div>
                <h2>Probar si funciona</h2>
                <pre class="codigo" translate="no"><code class="bash">service bind9 start</code></pre>
                <pre class="codigo" translate="no"><code class="bash">service bind9 status</code></pre>
                <pre class="codigo" translate="no"><code class="bash">named-checkconf</code></pre>
                <pre class="codigo" translate="no"><code class="bash">named-checkzone adr.es /etc/bind/db.adr.es</code></pre>
            </div>
           
            <div>
                <h2>Rutas Importantes</h2>
                <p>Fichero de Configuración del servidor:</p>
                <p><span class="ruta" translate="no">/etc/bind/named.conf</span></p>

                <p>Fichero de zonas:</p>
                <p><span class="ruta" translate="no">/etc/bind/named.conf.local</span></p>

                <p>Fichero de zonas por defecto - root:</p>
                <p><span class="ruta" translate="no">/etc/bind/named.conf.default-zones</span></p>

                <p>Fichero de Configuración del DNS:</p>
                <p><span class="ruta" translate="no">/etc/bind/named.conf.options</span></p>
            </div>


            <div>
                <h2>Si hay problemas en el DNS</h2>
                <pre class="codigo" translate="no"><code class="bash">nano /etc/hosts</code></pre>
                <pre class="codigo" translate="no"><code class="bash">nano /etc/resolv.conf</code></pre>
                <pre class="codigo" translate="no"><code class="bash">systemctl restart networking</code></pre>
                <pre class="codigo" translate="no"><code class="bash">systemctl restart NetworkManager</code></pre>
            </div>
        </div>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <hr>
        <div class="parte1">
            <div>
                <h2>Nslookup (Windows y Linux)</h2>
                <p>Sirve para comprobar la configuración DNS de un dominio o IP según un registro específico.</p>
                <p>Servidores DNS del dominio:</p>
                <pre class="codigo" translate="no"><code class="console">> 127.0.0.1
> set type=NS
> adr.es</code></pre>
                <p>Servidores de correo:</p>
                <pre class="codigo" translate="no"><code class="console">> 192.168.1.100
> set type=MX
> ibm.com</code></pre>
                <p>Nombres asociados a una IPv4:</p>
                <pre class="codigo" translate="no"><code class="console">> 127.0.0.1
> set type=A
> asml.com</code></pre>
            </div>
            <div>
                <h2>Configurar DNS como Reenviador</h2>
                <p><span class="ruta" translate="no">/etc/bind/named.conf.local</span>:</p>
                <pre class="codigo" translate="no"><code class="nginx">options {
directory "/var/cache/bind";

forwarders {
192.168.8.1;
};

dnssec-validation no;
auth-nxdomain no;    # conform to RFC1035

listen-on { any; };
// listen-on-v6 { any; };
};</code></pre>
            </div>
        </div>
        <hr>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <div class="parte1">
            <div>
                <h2>Crear una zona <span class="spanblanco">(ej.1)</span></h2>
                <p><span class="ruta" translate="no">/etc/bind/named.conf.local</span>:</p>
                <pre class="codigo" translate="no"><code class="bash">zone "adr.es"{
type master;
file "/etc/bind/db.adr.es";
};</code></pre>
                <p><span class="ruta" translate="no">/etc/bind/db.adr.es</span>:</p>
                <pre class="codigo" translate="no"><code class="nginx">$TTL    1D
adr.es. IN      SOA     dns1.adr.es.    administrador.adr.es    (
    1               ; N* de serie
    604800          ; Intervalo de actualización
    86400           ; Intervalo de reintento
    2419200         ; Expiración
    604800  )       ; TTL

adr.es. IN      NS      dns1.adr.es.
dns1    IN      A       192.168.0.230
www     IN      A       192.168.0.153
correo  IN      A       192.168.0.4
adr.es. IN      MX      1       correo
otra    IN      CNAME   iesjorgeguillen.es</code></pre>
                <p>Comprobar con nslookup:</p>
                <pre class="codigo" translate="no"><code class="console">> 127.0.0.1
> set type=NS
> adr.es</code></pre>
            </div>
            <!-- ......................................................... -->
            <div>
                <h2>Crear una zona inversa <span class="spanblanco">(ej.2)</span></h2>
                <p><span class="ruta" translate="no">/etc/bind/named.conf.local</span>:</p>
                <pre class="codigo" translate="no"><code class="nginx">zone "0.168.192.in-addr.arpa"{
type master;
file "/etc/bind/db.192.168.0";
};</code></pre>
                <p><span class="ruta" translate="no">/etc/bind/db.192.168.0</span>:</p>
                <pre class="codigo" translate="no"><code class="nginx">$TTL    1D
0.168.192.in-addr.arpa. IN      SOA     dns1.adr.es.    administrador.adr.es.   (
        1
        604800
        86400
        2419200
        10800   )

0.168.192.in-addr.arpa. IN      NS      dns1.adr.es.

230     IN      PTR     dns1.adr.es.
153     IN      PTR     www.adr.es.</code></pre>
                <p>Comprobar con nslookup:</p>
                <pre class="codigo" translate="no"><code class="console">> 127.0.0.1
> set type=PTR
> 230.0.168.192.in-addr.arpa.</code></pre>
            </div>
            <!-- ......................................................... -->
        </div>
        <hr>
        <!-- ......................................................... -->
        <div class="parte1">
            <!-- ......................................................... -->
            <div>
                <h2>Crear DNS secundario <span class="spanblanco">(ej.3)</span></h2>
                <p>En el servidor <b>DNS1</b>:<br><span class="ruta" translate="no">/etc/bind/named.conf.local</span>:</p>
                <pre class="codigo" translate="no"><code class="bash">listen-on {192.168.0.226;}; // La IP de dns2
allow-transfer {192.168.0.226;}; // La IP de dns2
allow-query {192.168.0.226;}; // La IP de dns2</code></pre>
                <p><span class="ruta" translate="no">/etc/bind/db.adr.es</span>:</p>
                <pre class="codigo" translate="no"><code class="bash">dns2	IN	A	192.168.0.226</code></pre>
                <p><br>En el servidor <b>DNS2</b>:<br><span class="ruta" translate="no">/etc/bind/named.conf.local</span>:</p>
                <pre class="codigo" translate="no"><code class="bash">zone "adr.es"{
type slave;
masters{192.168.0.226;}; // IP de DNS1
file "/etc/bind/db.jonis.net";
};</code></pre>
            </div>
            <!-- ......................................................... -->
            <div class="vacío"></div>
            <!-- ......................................................... -->
        </div>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <h1>DNS - WINDOWS SERVER</h1>
        <hr class="SeparadorConTitulo">
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <div class="parte1">
            <div>
                <h2>Configurar</h2>

                <p>Pasos:</p>
                <br>
                <ol>
                    <li>Poner IP Estática</li>
                    <li>Administrador del Servidor > Agregar rol servidor DNS > Instalar</li>
                    <li>Administrador del Servidor > Herramientas > DNS > Nombre_Servidor > Reenviadores > Editar > Añadir IP de un servidor DNS el cual será reenviador (ej: 192.168.8.1)</li>
                </ol>
                <p>Es necesario especificar con un registro A donde está el servidor DNS primario y crearle un registro NS.</p>
                <p>Para configurar registros A:</p>
                <p class="Expl">Administrador del Servidor > Herramientas > DNS > Nombre_Servidor > Zonas de Búsqueda directa > Click derecho > Registro A</p>

                <p>Para configurar registros MX:</p>
                <p class="Expl">" Pero no se pone nombre al registro</p>

            </div>
        </div>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <hr>
        <h2 class="TituloCreditosInferior"><a href="https://byAd12.pages.dev/guides" target="_blank">byAd12.pages.dev/guides</a></h2>
        <!-- ......................................................... -->
        <!-- ......................................................... -->
        <script src="../recursos/blog.js"></script>
    </body>
</html>